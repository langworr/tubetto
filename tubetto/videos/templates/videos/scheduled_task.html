{% extends "base.html" %}
{% block title %}Scheduled Task - Tubetto{% endblock %}
{% block content %}
<h1>Scheduled Tasks</h1>
<p>Run individual tasks or all tasks at once:</p>

<div style="display: flex; flex-wrap: wrap; gap: 1rem; margin: 2rem 0;">
  <form method="post" style="margin: 0;">
    {% csrf_token %}
    <button type="submit" name="update_channels" style="padding: 0.75rem 1.5rem; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem;">
      1. Update Channels Metadata
    </button>
  </form>

  <form method="post" style="margin: 0;">
    {% csrf_token %}
    <button type="submit" name="scan_videos" style="padding: 0.75rem 1.5rem; background-color: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem;">
      2. Scan Channel Videos
    </button>
  </form>

  <form method="post" style="margin: 0;">
    {% csrf_token %}
    <button type="submit" name="update_videos_metadata" style="padding: 0.75rem 1.5rem; background-color: #9b59b6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem;">
      3. Update Videos Metadata
    </button>
  </form>

  <form method="post" style="margin: 0;">
    {% csrf_token %}
    <button type="submit" name="update_music_tracks" style="padding: 0.75rem 1.5rem; background-color: #e67e22; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem;">
      4. Update Music Tracks Metadata
    </button>
  </form>

  <form method="post" style="margin: 0;">
    {% csrf_token %}
    <button type="submit" name="run_all" style="padding: 0.75rem 1.5rem; background-color: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: bold;">
      Run All Tasks
    </button>
  </form>
</div>

{% if results %}
  <section style="margin-top: 2rem; padding: 1.5rem; background-color: #f9f9f9; border-radius: 4px;">
    <h2>Task Results: {{ task_name }}</h2>
    
    {% if task_name == "All Tasks" %}
      <h3>Channels</h3>
      <ul>
        <li>Channels processed: {{ results.channels.channels_processed }}</li>
        <li>Channels updated: {{ results.channels.channels_updated }}</li>
        {% if results.channels.channels_errors %}
          <li>Errors: {{ results.channels.channels_errors|length }}
            <ul>
              {% for error in results.channels.channels_errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.channels.channels_errors|length > 10 %}
                <li style="color: red;">... and {{ results.channels.channels_errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
      
      <h3>Video Scanning</h3>
      <ul>
        <li>Channels scanned: {{ results.scan.channels_scanned }}</li>
        <li>Videos scanned: {{ results.scan.videos_scanned }}</li>
        <li>Videos created: {{ results.scan.videos_created }}</li>
        <li>Videos updated: {{ results.scan.videos_updated }}</li>
        {% if results.scan.errors %}
          <li>Errors: {{ results.scan.errors|length }}
            <ul>
              {% for error in results.scan.errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.scan.errors|length > 10 %}
                <li style="color: red;">... and {{ results.scan.errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
      
      <h3>Videos Metadata</h3>
      <ul>
        <li>Videos processed: {{ results.videos.videos_processed }}</li>
        <li>Videos updated: {{ results.videos.videos_updated }}</li>
        {% if results.videos.errors %}
          <li>Errors: {{ results.videos.errors|length }}
            <ul>
              {% for error in results.videos.errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.videos.errors|length > 10 %}
                <li style="color: red;">... and {{ results.videos.errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>

      <h3>Music Tracks</h3>
      <ul>
        <li>Tracks processed: {{ results.music.tracks_processed }}</li>
        <li>Tracks updated: {{ results.music.tracks_updated }}</li>
        {% if results.music.errors %}
          <li>Errors: {{ results.music.errors|length }}
            <ul>
              {% for error in results.music.errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.music.errors|length > 10 %}
                <li style="color: red;">... and {{ results.music.errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
    {% elif task_name == "Update Channels Metadata" %}
      <ul>
        <li>Channels processed: {{ results.channels_processed }}</li>
        <li>Channels updated: {{ results.channels_updated }}</li>
        {% if results.channels_errors %}
          <li>Errors: {{ results.channels_errors|length }}
            <ul>
              {% for error in results.channels_errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.channels_errors|length > 10 %}
                <li style="color: red;">... and {{ results.channels_errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
    {% elif task_name == "Scan Channel Videos" %}
      <ul>
        <li>Channels scanned: {{ results.channels_scanned }}</li>
        <li>Videos scanned: {{ results.videos_scanned }}</li>
        <li>Videos created: {{ results.videos_created }}</li>
        <li>Videos updated: {{ results.videos_updated }}</li>
        {% if results.errors %}
          <li>Errors: {{ results.errors|length }}
            <ul>
              {% for error in results.errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.errors|length > 10 %}
                <li style="color: red;">... and {{ results.errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
    {% elif task_name == "Update Videos Metadata" %}
      <ul>
        <li>Videos processed: {{ results.videos_processed }}</li>
        <li>Videos updated: {{ results.videos_updated }}</li>
        {% if results.errors %}
          <li>Errors: {{ results.errors|length }}
            <ul>
              {% for error in results.errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.errors|length > 10 %}
                <li style="color: red;">... and {{ results.errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
    {% elif task_name == "Update Music Tracks Metadata" %}
      <ul>
        <li>Tracks processed: {{ results.tracks_processed }}</li>
        <li>Tracks updated: {{ results.tracks_updated }}</li>
        {% if results.errors %}
          <li>Errors: {{ results.errors|length }}
            <ul>
              {% for error in results.errors|slice:":10" %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
              {% if results.errors|length > 10 %}
                <li style="color: red;">... and {{ results.errors|length|add:"-10" }} more errors</li>
              {% endif %}
            </ul>
          </li>
        {% endif %}
      </ul>
    {% endif %}
  </section>
{% endif %}
{% endblock %}

